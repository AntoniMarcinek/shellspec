ARG IMAGE

FROM shellspec:mksock as mksock
FROM $IMAGE
COPY --from=mksock mksock /usr/local/bin/mksock
COPY ./docker/* /docker/
RUN echo "--no-banner" > /home/user/.shellspec \
 && if [ "$(id -u)" -eq 0 ]; then ln -s /docker/fake-sudo.sh /bin/sudo; fi \
 && sudo mkdir -p /usr/local/bin \
 && sudo ln -s /docker/fake-nc.sh /usr/local/bin/nc \
 && sudo ln -s /shellspec/shellspec /usr/local/bin/shellspec \
 && sudo mkdir /shellspec \
 && sudo chown user:user /shellspec \
 && sudo /docker/replace_shell.sh "$SH"
WORKDIR /shellspec
ENTRYPOINT [ "/docker/entrypoint.sh" ]
CMD [ "shellspec" ]
COPY --chown=user:user ./ /shellspec
