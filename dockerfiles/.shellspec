ARG IMAGE

FROM shellspec:helpers as helpers

FROM $IMAGE
COPY --from=helpers /usr/local/bin/* /usr/local/bin/
WORKDIR /shellspec
RUN echo "--no-banner" > /home/user/.shellspec \
 && su-exec root ln -s /shellspec/shellspec /usr/local/bin/shellspec \
 && su-exec root sh -c "echo $SH > /etc/invokesh.conf" \
 && su-exec root chown user:user /shellspec \
 && [ "$SH" = "sh" ] || su-exec root ln -snf /usr/local/bin/invokesh /bin/sh

ENTRYPOINT [ "/shellspec/docker/entrypoint.sh" ]
CMD [ "shellspec" ]

COPY --chown=user:user ./ /shellspec
